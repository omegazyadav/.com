<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>Policy as Code: Cloudformation Guard | Yadav Lamichhane</title>
<meta property="og:title" content="Policy as Code: Cloudformation Guard | Yadav Lamichhane"><meta name=twitter:title content="Policy as Code: Cloudformation Guard | Yadav Lamichhane"><meta itemprop=name content="Policy as Code: Cloudformation Guard | Yadav Lamichhane"><meta name=application-name content="Policy as Code: Cloudformation Guard | Yadav Lamichhane"><meta property="og:site_name" content><meta name=description content="Policy as Code: Cloudformation Guard"><meta itemprop=description content="Policy as Code: Cloudformation Guard"><meta property="og:description" content="Policy as Code: Cloudformation Guard"><meta name=twitter:description content="Policy as Code: Cloudformation Guard"><meta property="og:locale" content="en-us"><meta name=language content="en-us"><link rel=alternate hreflang=en href=https://omegazyadav.com/posts/policy-as-code/ title><meta property="og:type" content="article"><meta property="og:article:published_time" content=2024-05-28T00:00:00Z><meta property="article:published_time" content=2024-05-28T00:00:00Z><meta property="og:url" content="https://omegazyadav.com/posts/policy-as-code/"><meta property="og:article:author" content="Yadav Lamichhane"><meta property="article:author" content="Yadav Lamichhane"><meta name=author content="Yadav Lamichhane"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Policy as Code: Cloudformation Guard","author":{"@type":"Person","name":""},"datePublished":"2024-05-28","description":"Policy as Code: Cloudformation Guard","wordCount":396,"mainEntityOfPage":"True","dateModified":"2024-05-28","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"Yadav Lamichhane"}}</script><meta name=generator content="Hugo 0.128.2"><meta property="og:url" content="https://omegazyadav.com/posts/policy-as-code/"><meta property="og:site_name" content="Yadav Lamichhane"><meta property="og:title" content="Policy as Code: Cloudformation Guard"><meta property="og:description" content="Policy as Code: Cloudformation Guard"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-28T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-28T00:00:00+00:00"><meta property="article:tag" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="Policy as Code: Cloudformation Guard"><meta name=twitter:description content="Policy as Code: Cloudformation Guard"><link rel=canonical href=https://omegazyadav.com/posts/policy-as-code/><link href=/style.min.2d921c18cf1ec555ffc03d59a8adc211c402c68c930c27d6a0c306ab175a8d09.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://omegazyadav.com/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><meta name=color-scheme content="light dark"><link rel=icon type=image/svg+xml href=/icons/favicon.svg></head><body data-theme class=notransition><script src=/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=/ class=logo><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title/><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
</a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class="menu-link active" href=/posts/>Posts</a></li><li><a class=menu-link href=/bio/>Bio</a></li><li class=menu-separator><span>|</span></li><li class=menu-link><ul><a class=rss href=https://github.com/omegazyadav style=text-decoration:none target=_blank><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" fill="currentcolor"><title>Yadav Lamichhane on GitHub</title><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59C5.87 15.66 6.02 15.42 6.02 15.21 6.02 15.02 6.01 14.39 6.01 13.72 4 14.09 3.48 13.23 3.32 12.78 3.23 12.55 2.84 11.84 2.5 11.65 2.22 11.5 1.82 11.13 2.49 11.12 3.12 11.11 3.57 11.7 3.72 11.94 4.44 13.15 5.59 12.81 6.05 12.6 6.12 12.08 6.33 11.73 6.56 11.53 4.78 11.33 2.92 10.64 2.92 7.58c0-.87.31-1.59.82-2.15C3.66 5.23 3.38 4.41 3.82 3.31c0 0 .67-.21 2.2.82C6.66 3.95 7.34 3.86 8.02 3.86S9.38 3.95 10.02 4.13c1.53-1.04 2.2-.82 2.2-.82C12.66 4.41 12.38 5.23 12.3 5.43 12.81 5.99 13.12 6.7 13.12 7.58c0 3.07-1.87 3.75-3.65 3.95C9.76 11.78 10.01 12.26 10.01 13.01 10.01 14.08 10 14.94 10 15.21 10 15.42 10.15 15.67 10.55 15.59 13.71 14.53 16 11.53 16 8c0-4.42-3.58-8-8-8z" transform="scale(64)"/></svg></a></ul></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>Policy as Code: Cloudformation Guard</h1><div class=post-meta><time datetime=2024-05-28T00:00:00+00:00 itemprop=datePublished>May 28, 2024</time></div></header><div class=page-content><p>CloudFormation Guard (cfn-guard) is a tool developed by AWS to validate CloudFormation templates against a set of predefined rules. It ensures that your infrastructure as code (IaC) complies with organizational policies, security requirements, and best practices before deployment.</p><h2 id=key-features>Key Features</h2><ol><li><strong>Policy-as-Code</strong>: Define reusable and version-controlled rules.</li><li><strong>Validation</strong>: Check CloudFormation templates against these rules.</li><li><strong>Compliance</strong>: Enforce security, cost management, and operational guidelines.</li><li><strong>Integration</strong>: Seamlessly integrates with CI/CD pipelines for automated checks.</li></ol><h2 id=installing-cloudformation-guard>Installing CloudFormation Guard</h2><p>You can install CloudFormation Guard using AWS CLI or download it from the <a href=https://github.com/aws-cloudformation/cloudformation-guard/releases>releases page</a>.</p><h3 id=using-cli>Using CLI</h3><ol><li>Open a terminal, and run the following command.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl --proto <span style=color:#e6db74>&#39;=https&#39;</span> --tlsv1.2 -sSf https://raw.githubusercontent.com/aws-cloudformation/cloudformation-guard/main/install-guard.sh | sh
</span></span></code></pre></div><ol start=2><li>Run the following command to set your PATH variable.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>~/.guard/bin:$PATH
</span></span></code></pre></div><h3 id=downloading-binary>Downloading Binary</h3><p>Download the appropriate binary for your operating system from the <a href=https://github.com/aws-cloudformation/cloudformation-guard/releases>releases page</a> and add it to your PATH.</p><h2 id=writing-guard-rules>Writing Guard Rules</h2><p>Guard rules are written in a simple, declarative language. Here’s an example rule to ensure that S3 buckets have versioning enabled:</p><pre tabindex=0><code>let s3_buckets = Resources.*[ Type == &#34;AWS::S3::Bucket&#34; ]

rule check_s3_versioning {
    s3_buckets.Properties.VersioningConfiguration.Status == &#34;Enabled&#34;
}
</code></pre><h2 id=validating-a-template>Validating a Template</h2><p>To validate a CloudFormation template, use the cfn-guard validate command with the rule set and template file.</p><pre tabindex=0><code>cfn-guard validate --rules rules.guard --data bucket.yaml
</code></pre><h2 id=use-case><strong>Use Case</strong></h2><h2 id=object-encryption-and-lifecycle-policies-for-s3-bucket>Object Encryption and Lifecycle policies for s3 bucket</h2><pre tabindex=0><code>Resources:
  DevOpsLearningBucket:
    Type: &#39;AWS::S3::Bucket&#39;
    Properties:
      LifecycleConfiguration:
        Rules:
          - Id: ExpirationDays
            Status: &#39;Enabled&#39;
            ExpirationInDays: 30
      BucketName: devops-learning-101
      BucketEncryption:
        ServerSideEncryptionConfiguration:
        - ServerSideEncryptionByDefault:
            SSEAlgorithm: aws:kms
      PublicAccessBlockConfiguration:
        BlockPublicAcls: TRUE
        BlockPublicPolicy: TRUE
        IgnorePublicAcls: TRUE
        RestrictPublicBuckets: TRUE
      Tags:
        - Key: Name
          Value: !Join [&#39;-&#39;, [ !Ref Environment, &#39;s3&#39;, &#39;DevOpsLearning101&#39; ]]
    DeletionPolicy: Delete
</code></pre><p><strong>Guard Rules</strong></p><pre tabindex=0><code>let s3_buckets = Resources.*[ Type == &#39;AWS::S3::Bucket&#39; ]
let allowed_algos = [&#34;aws:kms&#34;, &#34;AES256&#34;]

rule s3_buckets_allowed_sse_algorithm when %s3_buckets !empty {
    let encryption = %s3_buckets.Properties.BucketEncryption
    %encryption exists
    %encryption.ServerSideEncryptionConfiguration[*].ServerSideEncryptionByDefault.SSEAlgorithm in %allowed_algos
}


let lifecycleRules = Resources.*[ Type == &#39;AWS::S3::Bucket&#39; ].Properties.LifecycleConfiguration.Rules

rule check_lifecycle_status {
    # Ensure lifecycle rules are enabled
    %lifecycleRules.*.Status == &#39;Enabled&#39;
}

rule check_lifecycle_expiration {
    %lifecycleRules.*.ExpirationInDays == 30
}
</code></pre><h3 id=validating-the-template>Validating the Template</h3><pre tabindex=0><code>cfn-guard validate --rules rules.guard --data bucket.yaml -S pass
</code></pre><h3 id=output>Output</h3><pre tabindex=0><code>❯ cfn-guard validate --rules rules.guard --data bucket.yaml -S pass
/Users/yadavlamichhane/cf/repos/aggregated-data-subsystem/comp/buckets/snowflake-stage/bucket.yaml Status = PASS
PASS rules
rules.guard/s3_buckets_allowed_sse_algorithm    PASS
rules.guard/check_lifecycle_status              PASS
rules.guard/check_lifecycle_expiration          PASS
</code></pre><h2 id=conclusion>Conclusion</h2><p>CloudFormation Guard is a powerful tool to ensure that your CloudFormation templates meet the required policies and standards. By integrating it into your CI/CD pipelines, you can automate compliance checks and prevent non-compliant infrastructure from being deployed. For more information, refer to the <a href=https://github.com/aws-cloudformation/cloudformation-guard>official documentation</a>.</p></div></article></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/omegazyadav target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://twitter.com/omegazyadav target=_blank rel="noopener noreferrer me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</a><a href=https://linkedin.com/omegazyadav target=_blank rel="noopener noreferrer me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a><a href=https://mastodon.social/@omegazyadav target=_blank rel="noopener noreferrer me" title=Mastodon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.58 13.913c-.29 1.469-2.592 3.121-5.238 3.396-1.379.184-2.737.368-4.185.276-2.368-.092-4.237-.551-4.237-.551.0.184.014.459.043.643.308 2.294 2.317 2.478 4.22 2.57 1.922.0 3.633-.46 3.633-.46l.079 1.653s-1.344.734-3.738.918c-1.32.091-2.96-.092-4.869-.551-4.14-1.102-4.853-5.507-4.961-10.005-.034-1.285-.013-2.57-.013-3.58.0-4.589 3-5.966 3-5.966 1.513-.734 4.11-1.01 6.808-1.01h.067c2.699.0 5.296.276 6.81 1.01.0.0 3 1.377 3 5.967.0.0.037 3.304-.419 5.69" stroke="currentcolor"/><path d="M17.832 8.633v5h-1.978V8.78c0-1.023-.43-1.542-1.29-1.542-.95.0-1.427.616-1.427 1.834v2.655H11.17V9.072c0-1.218-.476-1.834-1.427-1.834-.86.0-1.29.52-1.29 1.542v4.852H6.475V8.633c0-1.022.26-1.834.782-2.434.538-.6 1.243-.909 2.118-.909 1.012.0 1.779.39 2.286 1.169l.492.827.493-.827c.507-.78 1.274-1.169 2.286-1.169.875.0 1.58.308 2.118.909.522.6.782 1.412.782 2.434" fill="currentcolor" stroke="none"/></svg>
</a><a href=https://medium.com/omegazyadav target=_blank rel="noopener noreferrer me" title=Medium><svg version="1.0" xmlns="http://www.w3.org/2000/svg" fill="currentcolor" stroke-width="2" viewBox="0 0 76 76"><g transform="translate(0.000000,76.000000) scale(0.100000,-0.100000)"><path d="M0 380V0h380 380v380 380H380 0V380zm334 85c30-63 57-115 59-115s16 30 31 68c15 37 37 88 49 115l20 47h76l76-1-27-20-28-21V387c0-150 0-151 27-179l27-28H535 426l27 28c26 27 27 32 26 143 0 131 3 134-71-58-24-62-48-113-53-113-6 0-17 16-24 35s-36 83-64 142l-52 108-3-98c-3-97-2-99 28-133 16-19 30-39 30-44 0-6-31-10-70-10-45 0-70 4-70 11 0 6 14 27 30 46 30 33 30 35 30 151s0 118-31 155l-30 37h75 76l54-115z"/></g></svg>
</a><a href=index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>© 2025 Yadav Lamichhane
<a href=https://gohugo.io target=_blank rel="noreferrer noopener"></a></small></footer><a href=# title="Go to top" id=totop><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentcolor" stroke="currentcolor" viewBox="0 96 960 960"><path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197z"/></svg>
</a><script src=https://omegazyadav.com/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30+lSNuSkl4QXuNyy8="></script></body></html>